{% set lines = lines or [] %}
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Receipt {{ receipt.receipt_no }}</title>
  <style>
    /* Screen defaults stay as-is; these rules only affect printing */
    @media print {
      @page { size: 80mm auto; margin: 0; }
      html, body { width: 80mm; margin: 0; padding: 0; }
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
      .receipt { width: 72mm; margin: 0 auto; padding: 0; }
      * { break-inside: avoid; }
      html, body, .receipt { min-height: auto !important; height: auto !important; }
    }

    /* Basic receipt visuals (screen + print) */
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:#000; }
    .center { text-align: center; }
    .row { display: flex; justify-content: space-between; gap: 4px; }
    .muted { color: #444; }
    hr { border: none; border-top: 1px dashed #444; margin: 6px 0; }
    .totals .row { font-weight: 700; }
    .small { font-size: 12px; }
    .section { margin: 6px 0; }
  </style>
  </head>
<body onload="window.print()">
  <div class="receipt">
    <div class="center section">
      <div><strong>Conserv Building Solutions</strong></div>
      <div class="small muted">Receipt {{ receipt.receipt_no }}</div>
      <div class="small muted">{{ (receipt.created_at.strftime('%Y-%m-%d %H:%M') if receipt.created_at) }}</div>
    </div>
    <hr/>
    {% if receipt.customer_name %}
      <div class="small">Customer: {{ receipt.customer_name }}</div>
    {% endif %}
    {% if receipt.notes %}
      <div class="small">{{ receipt.notes }}</div>
    {% endif %}
    <hr/>
    {% for li in lines %}
      <div class="row small">
        <div>{{ li.item_name }} x {{ '%.2f' % li.quantity }} {{ li.unit }}</div>
        <div>${{ '%.2f' % li.line_total }}</div>
      </div>
    {% endfor %}
    <hr/>
    <div class="totals section">
      <div class="row small"><div>Subtotal</div><div>${{ '%.2f' % (receipt.subtotal or 0) }}</div></div>
      {% if (receipt.tax or 0) > 0 %}
      <div class="row small"><div>Tax</div><div>${{ '%.2f' % (receipt.tax or 0) }}</div></div>
      {% endif %}
      <div class="row small"><div>Total</div><div>${{ '%.2f' % (receipt.total or 0) }}</div></div>
    </div>
    <hr/>
    <div class="center small muted section">Thank you!</div>
  </div>
  <div style="page-break-after: always;"></div>
</body>
</html>


